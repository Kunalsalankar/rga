# Live Camera â†’ Analysis â†’ Health Report Workflow

## Visual User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Solar Panel Dashboard (localhost:3000)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Solar Panels    â”‚
                    â”‚  Grid (6 panels) â”‚
                    â”‚  SP-001 to 006   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    User clicks on panel
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Panel Details Dialog    â”‚
                    â”‚  - Status                â”‚
                    â”‚  - Health Score          â”‚
                    â”‚  - Current Reading       â”‚
                    â”‚  [LIVE CAMERA] button â—„â”€â”€
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CameraViewer Modal                â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   ESP32 Live Camera Feed     â”‚  â”‚
                    â”‚  â”‚   (10.137.185.244/capture)   â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                                      â”‚
                    â”‚  [Analyze Image] [Download] [Refresh]
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                          User clicks "Analyze Image"
                                       â”‚
                                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚     IMAGE SENT TO FastAPI (port 8000)          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                      â”‚                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
         â”‚  OpenCV    â”‚         â”‚  ML Model   â”‚       â”‚   RAG   â”‚
         â”‚  Resize    â”‚         â”‚  Inference  â”‚       â”‚ Retrieval
         â”‚  640x640   â”‚         â”‚  (ONNX)     â”‚       â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                â”‚                      â”‚                      â”‚
                â”‚          Defect Type â”‚                      â”‚
                â”‚          Confidence  â”‚                      â”‚
                â”‚                      â”‚                Knowledge
                â”‚                      â”‚                Base Context
                â”‚                      â”‚                      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Gemini AI (gemini-pro)        â”‚
                     â”‚  Generates Expert Analysis     â”‚
                     â”‚  - Defect Impact               â”‚
                     â”‚  - Maintenance Actions         â”‚
                     â”‚  - Urgency Assessment          â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                            JSON Response with:
                            - fault_type
                            - confidence
                            - top_predictions
                            - gemini_analysis
                            - rag_context
                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       CameraViewer Closes Automatically               â”‚
        â”‚  onAnalysisComplete() callback triggers               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AnalysisHealthReport Modal Opens                     â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  HEALTH SCORE: 38%                   [Orange]  â”‚   â”‚
        â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                         â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”‚  ğŸ”´ URGENCY: MEDIUM                             â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”œâ”€ DEFECT DETECTION RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  Type: Dusty                                   â”‚   â”‚
        â”‚  â”‚  Confidence: 95.32% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘           â”‚   â”‚
        â”‚  â”‚  Alternatives:                                 â”‚   â”‚
        â”‚  â”‚  - Clean: 3.52% â–ˆâ–ˆâ–ˆâ–‘                           â”‚   â”‚
        â”‚  â”‚  - Bird-drop: 1.16% â–‘                          â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”œâ”€ AI EXPERT ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  "The panel shows significant dust              â”‚   â”‚
        â”‚  â”‚   accumulation at 95.32% confidence.            â”‚   â”‚
        â”‚  â”‚   Dust reduces solar efficiency by              â”‚   â”‚
        â”‚  â”‚   15-25% and should be cleaned..."             â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”œâ”€ RECOMMENDED ACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  ğŸ§¹ Panel requires cleaning. Dust reduces       â”‚   â”‚
        â”‚  â”‚     efficiency by 10-25%. Schedule cleaning     â”‚   â”‚
        â”‚  â”‚     immediately.                                â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”‚  [Close Report]  [Analyze Again]                â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    User closes report or analyzes again
                                       â”‚
                                       â–¼
                        Back to Dashboard
```

## Component Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SolarPanelGrid                             â”‚
â”‚  State:                                                       â”‚
â”‚  - selectedPanel                                              â”‚
â”‚  - showCamera                                                 â”‚
â”‚  - showAnalysisReport                                         â”‚
â”‚  - analysisResult                                             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PanelCard                                              â”‚  â”‚
â”‚  â”‚ onClick â†’ handlePanelClick(panel)                      â”‚  â”‚
â”‚  â”‚ "LIVE CAMERA" button â†’ handleOpenCamera()             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                       â”‚
â”‚                       â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CameraViewer                                           â”‚  â”‚
â”‚  â”‚ Props:                                                 â”‚  â”‚
â”‚  â”‚  - open: showCamera                                    â”‚  â”‚
â”‚  â”‚  - panelId: selectedPanel.panel_id                     â”‚  â”‚
â”‚  â”‚  - onClose: handleCloseCamera                          â”‚  â”‚
â”‚  â”‚  - onAnalysisComplete: handleAnalysisComplete â—„â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚                                                   â”‚   â”‚  â”‚
â”‚  â”‚ Inside CameraViewer:                             â”‚   â”‚  â”‚
â”‚  â”‚ 1. Load live feed from ESP32                     â”‚   â”‚  â”‚
â”‚  â”‚ 2. User clicks "Analyze Image"                   â”‚   â”‚  â”‚
â”‚  â”‚ 3. Fetch http://localhost:8000/analyze-image     â”‚   â”‚  â”‚
â”‚  â”‚ 4. setAnalysisResult(result)                      â”‚   â”‚  â”‚
â”‚  â”‚ 5. onAnalysisComplete(result) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚  â”‚
â”‚  â”‚                                             â”‚    â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”˜  â”‚
â”‚                                                â”‚    â”‚        â”‚
â”‚                                                â”‚    â”‚        â”‚
â”‚  handleAnalysisComplete(result) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚
â”‚  {                                                  â”‚        â”‚
â”‚    setAnalysisResult(result)                        â”‚        â”‚
â”‚    setShowCamera(false)                             â”‚        â”‚
â”‚    setShowAnalysisReport(true)                      â”‚        â”‚
â”‚  }                                                  â”‚        â”‚
â”‚                                                     â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚ AnalysisHealthReport                         â”‚  â”‚        â”‚
â”‚  â”‚ Props:                                       â”‚  â”‚        â”‚
â”‚  â”‚  - open: showAnalysisReport                  â”‚  â”‚        â”‚
â”‚  â”‚  - panelId: selectedPanel.panel_id            â”‚  â”‚        â”‚
â”‚  â”‚  - analysisResult: analysisResult â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜        â”‚
â”‚  â”‚                                              â”‚            â”‚
â”‚  â”‚ Displays:                                   â”‚            â”‚
â”‚  â”‚ - Health Score (calculated from result)     â”‚            â”‚
â”‚  â”‚ - Urgency Level (determined from defect)    â”‚            â”‚
â”‚  â”‚ - ML Results (from result.ml_result)         â”‚            â”‚
â”‚  â”‚ - Gemini Analysis (from result.gemini_...)   â”‚            â”‚
â”‚  â”‚ - Recommended Actions (context-specific)    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Transitions

```
Initial State:
â”œâ”€ selectedPanel: null
â”œâ”€ showCamera: false
â”œâ”€ showAnalysisReport: false
â””â”€ analysisResult: null

â†“ User clicks panel card

â”œâ”€ selectedPanel: {panel_id: "SP-001", ...}
â”œâ”€ showCamera: false
â”œâ”€ showAnalysisReport: false
â””â”€ analysisResult: null

â†“ User clicks "LIVE CAMERA"

â”œâ”€ selectedPanel: {panel_id: "SP-001", ...}
â”œâ”€ showCamera: true  â—„â”€â”€ CameraViewer opens
â”œâ”€ showAnalysisReport: false
â””â”€ analysisResult: null

â†“ User clicks "Analyze Image"

â”œâ”€ selectedPanel: {panel_id: "SP-001", ...}
â”œâ”€ showCamera: true  â—„â”€â”€ Still open, analyzing...
â”œâ”€ showAnalysisReport: false
â””â”€ analysisResult: null

â†“ Analysis completes (onAnalysisComplete called)

â”œâ”€ selectedPanel: {panel_id: "SP-001", ...}
â”œâ”€ showCamera: false  â—„â”€â”€ Closed automatically
â”œâ”€ showAnalysisReport: true  â—„â”€â”€ Opens automatically
â””â”€ analysisResult: {ml_result, gemini_analysis, ...}

â†“ User closes health report

â”œâ”€ selectedPanel: {panel_id: "SP-001", ...}
â”œâ”€ showCamera: false
â”œâ”€ showAnalysisReport: false  â—„â”€â”€ Closed
â””â”€ analysisResult: {ml_result, gemini_analysis, ...}
```

## Features Summary

âœ… **Click Panel** â†’ Loads panel details  
âœ… **Live Camera** â†’ ESP32 camera feed  
âœ… **Analyze Image** â†’ FastAPI ML processing  
âœ… **Auto Close** â†’ Camera closes after analysis  
âœ… **Auto Show Report** â†’ Health report opens automatically  
âœ… **Health Score** â†’ Dynamic calculation 0-100%  
âœ… **Urgency Level** â†’ Low/Medium/High with color  
âœ… **ML Results** â†’ Defect type & confidence  
âœ… **AI Analysis** â†’ Gemini expert insights  
âœ… **Recommendations** â†’ Context-specific actions  

Complete workflow implemented! ğŸš€
